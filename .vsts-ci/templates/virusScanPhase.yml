jobs:
- job: virus_scan
  pool:
    name: 'PowerShell1ES'

  displayName: Virus Scan

  steps:
  - task: DownloadBuildArtifacts@0
    displayName: 'Download Build Artifacts'
    inputs:
      downloadType: specific

  - template: EsrpScan.yml@ComplianceRepo
    parameters:
      scanPath: $(System.ArtifactsDirectory)
      pattern: |
        **\*.rpm
        **\*.deb
        **\*.tar.gz
      scanningService: 'pwshEsrpScanning'

  - task: ms.vss-governance-buildtask.governance-build-task-component-detection.ComponentGovernanceComponentDetection@0
    displayName: 'Component Detection'

  - task: securedevelopmentteam.vss-secure-development-tools.build-task-policheck.PoliCheck@1
    displayName: 'Run PoliCheck'
    inputs:
      targetType: F
      optionsFC: 0
      optionsXS: 1
      optionsPE: '1|2|3|4'
      optionsHMENABLE: 0
      optionsRulesDBPath: '$(System.ArtifactsDirectory)\tools\terms\PowerShell-Terms-Rules.mdb'
      optionsUEPath: $(System.ArtifactsDirectory)\tools\terms\TermsExclusion.xml
    continueOnError: true

