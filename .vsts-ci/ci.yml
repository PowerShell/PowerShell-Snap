name: PR-$(System.PullRequest.PullRequestNumber)-$(Date:yyyyMMdd)$(Rev:.rr)
resources:
- repo: self
  clean: true

phases:

- phase: Set_Build_Name
#  displayName: Set Build Name
  condition: ne(variables['Build.Reason'], 'PullRequest')
  queue:
    name: Hosted Ubuntu 1604
  steps:
  - powershell:  Write-Host "##vso[build.updatebuildnumber]$env:BUILD_SOURCEBRANCHNAME-$env:BUILD_SOURCEVERSION-$((get-date).ToString("yyyyMMddhhss"))"
    displayName: Set Build Name for Non-PR
    condition: ne(variables['Build.Reason'], 'PullRequest')

- template: ./phase.yml
  parameters:
    SnapChannel: stable
    SnapName: powershell

- template: ./phase.yml
  parameters:
    SnapChannel: preview
    SnapName: powershell-preview
